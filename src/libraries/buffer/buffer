// -*- mode: c++ -*-
// vim: set ft=cpp:
#pragma once

#include <string>
#include <utility>

template <typename T, isize Size>
struct Buffer {
    static constexpr isize length = Size;
    T value[Size];

    constexpr Buffer() = default;
    constexpr Buffer(Buffer<T, Size>&& in_buffer) = default;
    constexpr auto operator=(Buffer<T, Size>&&) -> Buffer<T, Size>& = default;

    template <typename... U>
    constexpr Buffer(U&&... arguments) requires(sizeof...(arguments) == Size) {
        T unpacked_data[Size] = {arguments...};
        for (int4 i = 0; i < Size; i++) {
            this->value[i] = unpacked_data[i];
        }
    }

    // TODO: Non-pessimize unsigned indices as well.
    auto operator[](isize i) -> T& {
        return value[i];
    }

    auto to_string() -> StringView
        requires(meta::is_same_v<meta::remove_const_t<T>, char>) {
        return StringView(static_cast<char const*>(static_cast<void*>(&value)),
                          Size);
    }
};
