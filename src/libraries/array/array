// -*- mode: c++ -*-
// vim: set ft=cpp:
#pragma once

struct Array {
    int* data;
    void free() {
        delete[] data;
    }
};

template <typename T>
struct RAII : T {
    ~RAII() {
        // clang-format off
        static_assert(requires() { this->free(); },
"The type that RAII wraps does not contain a `free()` method, \
but that is required for RAII!");
        // clang-format on
        this->free();
    }
};

auto main() -> int {
    Array foo;
    foo.data = new int[4];
    foo.free();

    RAII<Array> bar;
    bar.data = new int[4];
}
